---
// src/components/motorsport/ParallaxVideo.astro

import mainVideo from "@/assets/motorsport/main_s14.mp4";
import mainVideoMobile from "@/assets/motorsport/main_s14_mobile.mp4";
---

<section id="parallax-video-section" class="relative z-10 h-screen w-full overflow-hidden">
  
  <div class="absolute inset-0 z-0">
    <video
      src={mainVideo}
      autoplay
      loop
      muted
      playsinline
      class="hidden h-full w-full object-cover md:block"
    ></video>
    <video
      src={mainVideoMobile}
      autoplay
      loop
      muted
      playsinline
      class="block h-full w-full object-cover md:hidden"
    ></video>
    <div class="absolute inset-0 bg-black/40"></div>
  </div>

  <div class="relative z-10 flex h-full items-center justify-center overflow-hidden">
    <div class="relative w-full max-w-4xl px-8 text-center text-white h-auto">
      <p class="parallax-text text-4xl font-bold leading-tight md:text-6xl">
        Ocho meses de sudor, sacrificio y sueños soldados.
      </p>
      <p class="parallax-text absolute inset-x-0 top-0 text-4xl font-bold leading-tight md:text-6xl">
        Cada pieza instalada fue una batalla ganada a las 2 AM.
      </p>
      <p class="parallax-text absolute inset-x-0 top-0 text-4xl font-bold leading-tight md:text-6xl">
        No se trata solo de caballos de fuerza, sino de no rendirse jamás.
      </p>
      <p class="parallax-text absolute inset-x-0 top-0 text-4xl font-bold leading-tight md:text-6xl">
        Este S14 no es un carro. Es prueba de que los sueños se construyen.
      </p>
    </div>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  // SCRIPT SIMPLIFICADO: Se elimina la restricción de matchMedia
  // para que la animación se ejecute en TODAS las pantallas.
  const texts = gsap.utils.toArray(".parallax-text");

  gsap.set(texts.slice(1), { yPercent: 120, opacity: 0 });

  const timeline = gsap.timeline({
    scrollTrigger: {
      trigger: "#parallax-video-section",
      pin: true,
      scrub: 1,
      start: "top top",
      end: "+=250%", // La duración relativa funciona bien en cualquier alto de pantalla
    },
  });
  
  texts.forEach((text, i) => {
    if (i > 0) {
      timeline
        .to(texts[i - 1], {
          yPercent: -120,
          opacity: 0,
          duration: 1,
          ease: "power2.inOut",
        })
        .to(text, {
          yPercent: 0,
          opacity: 1,
          duration: 1,
          ease: "power2.inOut",
        }, "<");
    }
    
    if (i < texts.length - 1) {
      timeline.to({}, { duration: 1.5 });
    }
  });
</script>