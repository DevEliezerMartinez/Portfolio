---
// Welcome.astro - Sección con reveal de texto y parallax de imágenes
import img1 from '@/assets/motorsport/s14/1.png';
import img2 from '@/assets/motorsport/s14/2.png';
import img3 from '@/assets/motorsport/s14/3.png';
import img4 from '@/assets/motorsport/s14/4.png';
import img5 from '@/assets/motorsport/s14/5.png';
import img6 from '@/assets/motorsport/s14/6.png';
import img7 from '@/assets/motorsport/s14/7.png';
import img8 from '@/assets/motorsport/s14/8.png';
import img9 from '@/assets/motorsport/s14/9.png';
---

<section class="welcome-section relative w-full min-h-[150vh] flex items-center bg-black overflow-hidden z-10">
  <!-- Contenedor de imágenes parallax (izquierda) -->
  <div id="parallax-wrapper" class="absolute top-0 left-0 bottom-0 w-1/2 lg:w-2/5">
    <div id="parallax-content" class="relative w-full h-full">
       <div class="parallax-images">
        <img data-speed="0.8" src={img1.src} alt="Motorsport S14 1" class="parallax-img">
        <img data-speed="0.9" src={img2.src} alt="Motorsport S14 2" class="parallax-img">
        <img data-speed="1" src={img3.src} alt="Motorsport S14 3" class="parallax-img">
        <img data-speed="1.1" src={img4.src} alt="Motorsport S14 4" class="parallax-img">
        <img data-speed="0.9" src={img5.src} alt="Motorsport S14 5" class="parallax-img">
        <img data-speed="1.2" src={img6.src} alt="Motorsport S14 6" class="parallax-img">
        <img data-speed="0.8" src={img7.src} alt="Motorsport S14 7" class="parallax-img">
        <img data-speed="1" src={img8.src} alt="Motorsport S14 8" class="parallax-img">
        <img data-speed="0.9" src={img9.src} alt="Motorsport S14 9" class="parallax-img">
      </div>
    </div>
  </div>

  <!-- Contenido de texto (derecha) -->
  <div class="welcome-content relative z-10 ml-auto max-w-4xl px-8 md:px-16 lg:px-24 py-20 min-h-screen flex flex-col justify-center">
   <h2 class="welcome-text text-4xl md:text-5xl lg:text-6xl font-light leading-tight text-white">
  <span class="reveal-line">Este no es solo un carro.</span>
  <span class="reveal-line">Es la prueba de que un chavo</span>
  <span class="reveal-line">que lavaba coches a los 14 años</span>
  <span class="reveal-line">puede <span class="text-gray-600">construir sus propios sueños.</span></span>
  <span class="reveal-line">Kenyi Nakamura <span class="text-gray-600">y su equipo convirtieron</span></span>
  <span class="reveal-line">un S14 naranja <span class="text-gray-600">en una obra de arte</span></span>
  <span class="reveal-line">Midnight Purple. <span class="text-gray-600">Pura dedicación.</span></span>
</h2>

   
  </div>
</section>

<style>
  .welcome-section {
    background-color: #000000;
    margin-top: 0;
    isolation: isolate;
  }

  .welcome-text {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  .reveal-line {
    display: block;
    opacity: 0;
    transform: translateY(30px);
  }

  .reveal-line .text-gray-600 {
    color: #4b5563;
  }

  /* Parallax images container */
  #parallax-wrapper {
    position: absolute;
    height: 100%;
    top: 0;
    left: 0;
    pointer-events: none;
  }

  #parallax-content {
    overflow: visible;
    width: 100%;
    height: 100%;
  }

  .parallax-images {
    position: relative;
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
    height: 200vh;
    min-height: 200vh;
    display: grid;
    grid-template-columns: repeat(20, 5%);
    grid-template-rows: repeat(30, 3%);
    justify-content: center;
    align-items: center;
    padding-top: 20vh;
    padding-bottom: 20vh;
  }

  .parallax-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  }

  .parallax-img:nth-child(1) {
    grid-area: 1/1/6/8;
  }

  .parallax-img:nth-child(2) {
    grid-area: 3/12/8/20;
  }

  .parallax-img:nth-child(3) {
    grid-area: 9/5/13/15;
  }

  .parallax-img:nth-child(4) {
    grid-area: 14/1/18/8;
  }

  .parallax-img:nth-child(5) {
    grid-area: 16/12/20/19;
  }

  .parallax-img:nth-child(6) {
    grid-area: 20/2/25/9;
  }

  .parallax-img:nth-child(7) {
    grid-area: 22/11/24/20;
  }

  .parallax-img:nth-child(8) {
    grid-area: 26/5/30/15;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    #parallax-wrapper {
      width: 40%;
    }
  }

  @media (max-width: 768px) {
    #parallax-wrapper {
      display: none;
    }

    .welcome-content {
      margin-left: 0;
      max-width: 100%;
    }

    .welcome-text {
      font-size: 2rem;
    }
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  function initWelcomeAnimation() {
    const lines = document.querySelectorAll('.welcome-section .reveal-line');
    const cta = document.querySelector('.welcome-cta');
    const parallaxWrapper = document.getElementById('parallax-wrapper');

    if (!lines.length) return;

    // Animación de texto
    gsap.to(lines, {
      opacity: 1,
      y: 0,
      duration: 1,
      stagger: 0.15,
      ease: "power2.out",
      scrollTrigger: {
        trigger: '.welcome-section',
        start: 'top 70%',
        end: 'top 30%',
        toggleActions: 'play none none reverse',
      }
    });

    if (cta) {
      gsap.to(cta, {
        opacity: 1,
        duration: 0.8,
        delay: lines.length * 0.15 + 0.3,
        ease: "power2.out",
        scrollTrigger: {
          trigger: '.welcome-section',
          start: 'top 70%',
          toggleActions: 'play none none reverse',
        }
      });
    }

    // Parallax de imágenes
    if (parallaxWrapper) {
      const images = document.querySelectorAll('.parallax-img');
      
      // Animar cada imagen individualmente con parallax
      images.forEach((img) => {
        const speed = parseFloat(img.getAttribute('data-speed') || '1');
        const movement = (speed - 1) * 500; // Mayor rango de movimiento
        
        gsap.fromTo(img, 
          {
            y: -movement / 2
          },
          {
            y: movement / 2,
            ease: "none",
            scrollTrigger: {
              trigger: '.welcome-section',
              start: 'top bottom',
              end: 'bottom top',
              scrub: 1,
             // markers: true, // Descomentar para debug
            }
          }
        );
      });

      // Skew effect en las imágenes
      const skewSetter = gsap.quickTo(".parallax-img", "skewY");
      const clamp = gsap.utils.clamp(-10, 10);

      ScrollTrigger.create({
        trigger: '.welcome-section',
        start: 'top bottom',
        end: 'bottom top',
        onUpdate: (self) => {
          const velocity = self.getVelocity();
          skewSetter(clamp(velocity / -100));
        },
        onLeave: () => skewSetter(0),
        onEnterBack: () => skewSetter(0),
      });
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initWelcomeAnimation);
  } else {
    initWelcomeAnimation();
  }

  let resizeTimer: number;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      ScrollTrigger.refresh();
    }, 250);
  });
</script>