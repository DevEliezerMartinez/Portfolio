---
// Welcome.astro - Sección con reveal de texto y parallax de imágenes
import img1 from '@/assets/motorsport/s14/1.png';
import img2 from '@/assets/motorsport/s14/2.png';
import img3 from '@/assets/motorsport/s14/3.png';
import img4 from '@/assets/motorsport/s14/4.png';
import img5 from '@/assets/motorsport/s14/5.png';
import img6 from '@/assets/motorsport/s14/6.png';
import img7 from '@/assets/motorsport/s14/7.png';
import img8 from '@/assets/motorsport/s14/8.png';
import img9 from '@/assets/motorsport/s14/9.png';
---

<section class="welcome-section relative w-full h-[100vh] bg-black overflow-hidden">
  
  <!-- Contenedor de imágenes parallax (izquierda) -->
  <div class="parallax-wrapper absolute top-0 left-0 h-full w-1/2 lg:w-[45%] pointer-events-none overflow-hidden">
    <div class="parallax-images" data-speed="auto">
      <img data-speed="0.8" src={img1.src} alt="Motorsport S14 1" class="parallax-img">
      <img data-speed="0.9" src={img2.src} alt="Motorsport S14 2" class="parallax-img">
      <img data-speed="1" src={img3.src} alt="Motorsport S14 3" class="parallax-img">
      <img data-speed="1.1" src={img4.src} alt="Motorsport S14 4" class="parallax-img">
      <img data-speed="0.9" src={img5.src} alt="Motorsport S14 5" class="parallax-img">
      <img data-speed="1.2" src={img6.src} alt="Motorsport S14 6" class="parallax-img">
      <img data-speed="0.8" src={img7.src} alt="Motorsport S14 7" class="parallax-img">
      <img data-speed="1" src={img8.src} alt="Motorsport S14 8" class="parallax-img">
      <img data-speed="0.9" src={img9.src} alt="Motorsport S14 9" class="parallax-img">
    </div>
  </div>

  <!-- Contenido de texto (derecha) -->
  <div class="welcome-content absolute top-0 right-0 h-full w-1/2 lg:w-[55%] flex flex-col justify-center px-8 md:px-12 lg:px-16 xl:px-20">
    <h2 class="welcome-text text-3xl md:text-4xl lg:text-5xl font-light leading-tight text-white max-w-3xl">
      <span class="reveal-line">Este no es solo un carro.</span>
      <span class="reveal-line">Es la prueba de que un chavo</span>
      <span class="reveal-line">que lavaba coches a los 14 años</span>
      <span class="reveal-line">puede <span class="text-gray-600">construir sus propios sueños.</span></span>
      <span class="reveal-line">Kenyi Nakamura <span class="text-gray-600">y su equipo convirtieron</span></span>
      <span class="reveal-line">un S14 naranja <span class="text-gray-600">en una obra de arte</span></span>
      <span class="reveal-line">Midnight Purple. <span class="text-gray-600">Pura dedicación.</span></span>
    </h2>
  </div>
</section>

<style>
  .welcome-section {
    isolation: isolate;
  }

  .reveal-line {
    display: block;
    opacity: 0;
    transform: translateY(30px);
    margin-bottom: 1.9rem;
  }

  .reveal-line .text-gray-600 {
    color: #4b5563;
  }

  .parallax-images {
    padding-top: 5vh;
    position: relative;
    width: 100%;
    max-width: 450px;
    margin: 0 auto;
    height: 100%;
    display: grid;
    grid-template-columns: repeat(20, 5%);
    grid-template-rows: repeat(16, 6.25%);
    justify-content: center;
    align-items: center;
    gap: 0;
  }

  .parallax-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    will-change: transform;
  }

  .parallax-img:nth-child(1) {
    grid-area: 1/1/4/7;
  }

  .parallax-img:nth-child(2) {
    grid-area: 1/13/4/20;
  }

  .parallax-img:nth-child(3) {
    grid-area: 4/5/7/14;
  }

  .parallax-img:nth-child(4) {
    grid-area: 7/1/10/7;
  }

  .parallax-img:nth-child(5) {
    grid-area: 7/14/10/20;
  }

  .parallax-img:nth-child(6) {
    grid-area: 10/3/13/10;
  }

  .parallax-img:nth-child(7) {
    grid-area: 10/12/13/19;
  }

  .parallax-img:nth-child(8) {
    grid-area: 13/2/16/10;
  }

  .parallax-img:nth-child(9) {
    grid-area: 13/11/16/19;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .parallax-wrapper {
      width: 40%;
    }
  }

  @media (max-width: 768px) {
    .parallax-wrapper {
      display: none;
    }

    .welcome-content {
      margin-left: 0;
      max-width: 100%;
      padding-left: 2rem;
      padding-right: 2rem;
    }

    .welcome-text {
      font-size: 2rem;
    }
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  function initWelcomeAnimation() {
    const section = document.querySelector('.welcome-section');
    const lines = document.querySelectorAll('.welcome-section .reveal-line');
    const images = document.querySelectorAll('.parallax-img');

    if (!section || !lines.length) return;

    // Animación de texto con scroll trigger
    gsap.to(lines, {
      opacity: 1,
      y: 0,
      duration: 1,
      stagger: 0.15,
      ease: "power2.out",
      scrollTrigger: {
        trigger: section,
        start: 'top 80%',
        end: 'top 20%',
        toggleActions: 'play none none reverse',
      }
    });

    // Skew effect en las imágenes con velocidad del scroll
    const skewSetter = gsap.quickTo(images, "skewY", {
      duration: 0.5,
      ease: "power3.out"
    });
    const clamp = gsap.utils.clamp(-20, 20);

    ScrollTrigger.create({
      trigger: section,
      start: 'top bottom',
      end: 'bottom top',
      onUpdate: (self) => {
        const velocity = self.getVelocity();
        skewSetter(clamp(velocity / -50));
      },
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initWelcomeAnimation);
  } else {
    initWelcomeAnimation();
  }

  // Refresh ScrollTrigger on resize
  let resizeTimer: number;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      ScrollTrigger.refresh();
    }, 250);
  });
</script>